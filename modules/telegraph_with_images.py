import requests
import base64
import json
import os
from pathlib import Path

class TelegraphPublisher:
    def __init__(self, access_token):
        self.access_token = access_token
        self.base_url = "https://api.telegra.ph"

    def upload_image(self, image_path):
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä Telegra.ph"""
        try:
            with open(image_path, 'rb') as f:
                image_data = f.read()

            # –ö–æ–¥–∏—Ä—É–µ–º –≤ base64
            encoded_image = base64.b64encode(image_data).decode('utf-8')

            # –°–æ–∑–¥–∞–µ–º payload
            payload = {
                'access_token': self.access_token,
                'file': encoded_image
            }

            response = requests.post(f"{self.base_url}/upload", data=payload)

            if response.status_code == 200:
                result = response.json()
                if result.get('ok'):
                    return result['result'][0]['src']
                else:
                    print(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: {result}")
                    return None
            else:
                print(f"HTTP –æ—à–∏–±–∫–∞: {response.status_code}")
                return None

        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {e}")
            return None

    def create_article_with_images(self, title, content_nodes, author_name="Sandbox", author_url=""):
        """–°–æ–∑–¥–∞–µ—Ç —Å—Ç–∞—Ç—å—é —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏"""
        try:
            # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
            content_json = json.dumps(content_nodes)

            payload = {
                'access_token': self.access_token,
                'title': title,
                'author_name': author_name,
                'author_url': author_url,
                'content': content_json,
                'return_content': True
            }

            response = requests.post(f"{self.base_url}/createPage", data=payload)

            if response.status_code == 200:
                result = response.json()
                if result.get('ok'):
                    return result['result']['url']
                else:
                    print(f"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞—Ç—å–∏: {result}")
                    return None
            else:
                print(f"HTTP –æ—à–∏–±–∫–∞: {response.status_code}")
                return None

        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç–∞—Ç—å–∏: {e}")
            return None

    def create_cobrazera_article(self, image_paths=None):
        """–°–æ–∑–¥–∞–µ—Ç —Å—Ç–∞—Ç—å—é –æ Cobrazera"""

        # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç–∞—Ç—å–∏
        content = [
            # –ó–∞–≥–æ–ª–æ–≤–æ–∫
            {"tag": "h3", "children": ["üéÆ –ê–Ω–∞—Ä–±–∏–ª–µ–≥ 'Cobrazera' –£—É–≥–∞–Ω–±–∞—è—Ä: –ë—É–¥—É—â–µ–µ –º–æ–Ω–≥–æ–ª—å—Å–∫–æ–≥–æ CS2"]},

            # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 1
            {"tag": "img", "attrs": {"src": "/file/936f5b8d90b8876cf9bc1.jpg"}},

            # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            {"tag": "h4", "children": ["üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"]},
            {"tag": "ul", "children": [
                {"tag": "li", "children": ["–ü–æ–ª–Ω–æ–µ –∏–º—è: –ê–Ω–∞—Ä–±–∏–ª–µ–≥ –£—É–≥–∞–Ω–±–∞—è—Ä"]},
                {"tag": "li", "children": ["–ù–∏–∫–Ω–µ–π–º: Cobrazera"]},
                {"tag": "li", "children": ["–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: 3 –∞–≤–≥—É—Å—Ç–∞ 2005 –≥–æ–¥–∞"]},
                {"tag": "li", "children": ["–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: –ú–æ–Ω–≥–æ–ª–∏—è"]},
                {"tag": "li", "children": ["–¢–µ–∫—É—â–∞—è –∫–æ–º–∞–Ω–¥–∞: The MongolZ"]},
                {"tag": "li", "children": ["–ü–æ–∑–∏—Ü–∏—è: Rifler"]},
                {"tag": "li", "children": ["–ò–≥—Ä–∞: Counter-Strike 2"]},
                {"tag": "li", "children": ["–û–±—â–∏–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫: $8,290"]},
                {"tag": "li", "children": ["–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—É—Ä–Ω–∏—Ä–æ–≤: 6"]},
                {"tag": "li", "children": ["–†–µ–π—Ç–∏–Ω–≥ –≤ –ú–æ–Ω–≥–æ–ª–∏–∏: #81"]}
            ]},

            # –ö–∞—Ä—å–µ—Ä–Ω—ã–π –ø—É—Ç—å
            {"tag": "h4", "children": ["üöÄ –ö–∞—Ä—å–µ—Ä–Ω—ã–π –ø—É—Ç—å"]},
            {"tag": "p", "children": ["Cobrazera –Ω–∞—á–∞–ª —Å–≤–æ—é –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –∫–∞—Ä—å–µ—Ä—É –≤ 2024 –≥–æ–¥—É. –î–æ –ø—Ä–∏—Ö–æ–¥–∞ –≤ The MongolZ –æ–Ω –∏–≥—Ä–∞–ª –∑–∞ –∫–æ–º–∞–Ω–¥—É The Huns, –≥–¥–µ –ø—Ä–æ—è–≤–∏–ª —Å–µ–±—è –∫–∞–∫ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–π –º–æ–ª–æ–¥–æ–π –∏–≥—Ä–æ–∫."]},
            {"tag": "p", "children": ["–í 2025 –≥–æ–¥—É —Å–æ—Å—Ç–æ—è–ª—Å—è –µ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥ –≤ The MongolZ ‚Äî –≤–µ–¥—É—â—É—é –º–æ–Ω–≥–æ–ª—å—Å–∫—É—é –∫–∏–±–µ—Ä—Å–ø–æ—Ä—Ç–∏–≤–Ω—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é. –≠—Ç–æ—Ç –ø–µ—Ä–µ—Ö–æ–¥ —Å—Ç–∞–ª –≤–∞–∂–Ω—ã–º —ç—Ç–∞–ø–æ–º –≤ –µ–≥–æ –∫–∞—Ä—å–µ—Ä–µ, –æ—Ç–∫—Ä—ã–≤ –¥–æ—Å—Ç—É–ø –∫ –±–æ–ª–µ–µ —Å–µ—Ä—å–µ–∑–Ω—ã–º —Ç—É—Ä–Ω–∏—Ä–∞–º –∏ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–π –∞—Ä–µ–Ω–µ."]},

            # –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            {"tag": "h4", "children": ["üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è"]},
            {"tag": "ul", "children": [
                {"tag": "li", "children": ["MESA Pro Series Spring 2025 ‚Äî 1 –º–µ—Å—Ç–æ ($1,100)"]},
                {"tag": "li", "children": ["ESL Challenger League Season 49: Asia ‚Äî 3 –º–µ—Å—Ç–æ ($1,000)"]},
                {"tag": "li", "children": ["IESF World Championship 2024 ‚Äî 5-8 –º–µ—Å—Ç–æ ($2,500)"]},
                {"tag": "li", "children": ["Asian Champions League 2025 ‚Äî 5-6 –º–µ—Å—Ç–æ ($2,400)"]},
                {"tag": "li", "children": ["BLAST Open Spring 2025 ‚Äî 13-16 –º–µ—Å—Ç–æ ($1,000)"]},
                {"tag": "li", "children": ["The MongolZ Esports Club Championship #1 ‚Äî 1 –º–µ—Å—Ç–æ ($290)"]}
            ]},

            # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≥–æ–¥–∞–º
            {"tag": "h4", "children": ["üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≥–æ–¥–∞–º"]},
            {"tag": "table", "children": [
                {"tag": "tr", "children": [
                    {"tag": "th", "children": ["–ì–æ–¥"]},
                    {"tag": "th", "children": ["–ó–∞—Ä–∞–±–æ—Ç–æ–∫"]},
                    {"tag": "th", "children": ["–¢—É—Ä–Ω–∏—Ä—ã"]}
                ]},
                {"tag": "tr", "children": [
                    {"tag": "td", "children": ["2024"]},
                    {"tag": "td", "children": ["$2,790"]},
                    {"tag": "td", "children": ["2"]}
                ]},
                {"tag": "tr", "children": [
                    {"tag": "td", "children": ["2025"]},
                    {"tag": "td", "children": ["$5,500"]},
                    {"tag": "td", "children": ["4"]}
                ]}
            ]},

            # –ò–≥—Ä–æ–≤–æ–π —Å—Ç–∏–ª—å
            {"tag": "h4", "children": ["üéØ –ò–≥—Ä–æ–≤–æ–π —Å—Ç–∏–ª—å"]},
            {"tag": "p", "children": ["Cobrazera –∏–≥—Ä–∞–µ—Ç –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ rifler, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –µ–≥–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≤–∏–Ω—Ç–æ–≤–æ–∫ (AK-47, M4A4). –≠—Ç–∞ –ø–æ–∑–∏—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–ª–∏—á–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏, –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–∏–Ω—è—Ç–∏—è –±—ã—Å—Ç—Ä—ã—Ö —Ä–µ—à–µ–Ω–∏–π."]},
            {"tag": "p", "children": ["–í –≤–æ–∑—Ä–∞—Å—Ç–µ 19 –ª–µ—Ç –æ–Ω –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑—Ä–µ–ª–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –Ω–µ—Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–µ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –º–æ–ª–æ–¥—ã—Ö –∏–≥—Ä–æ–∫–æ–≤. –ï–≥–æ –ø–µ—Ä–µ—Ö–æ–¥ –≤ The MongolZ –ø—Ä–æ—à–µ–ª –≥–ª–∞–¥–∫–æ, —á—Ç–æ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤—É–µ—Ç –æ —Ö–æ—Ä–æ—à–µ–π –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–±–æ—Ç–µ."]},

            # –ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –º–æ–Ω–≥–æ–ª—å—Å–∫–æ–π —Å—Ü–µ–Ω—ã
            {"tag": "h4", "children": ["üá≤üá≥ –ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –º–æ–Ω–≥–æ–ª—å—Å–∫–æ–π —Å—Ü–µ–Ω—ã"]},
            {"tag": "p", "children": ["Cobrazera —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è –º–æ–Ω–≥–æ–ª—å—Å–∫–∏—Ö –∫–∏–±–µ—Ä—Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–Ω–∏–º–∞—é—Ç —É—Ä–æ–≤–µ–Ω—å —Ä–µ–≥–∏–æ–Ω–∞ –Ω–∞ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–π –∞—Ä–µ–Ω–µ. The MongolZ —É–∂–µ –¥–æ–∫–∞–∑–∞–ª–∏ —Å–≤–æ—é –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–∞ –∞–∑–∏–∞—Ç—Å–∫–æ–π —Å—Ü–µ–Ω–µ, –∏ —Ç–∞–∫–∏–µ –∏–≥—Ä–æ–∫–∏ –∫–∞–∫ Cobrazera —É–∫—Ä–µ–ø–ª—è—é—Ç –ø–æ–∑–∏—Ü–∏–∏ –∫–æ–º–∞–Ω–¥—ã."]},
            {"tag": "p", "children": ["–ú–æ–Ω–≥–æ–ª—å—Å–∫–∞—è —Å—Ü–µ–Ω–∞ CS2 –∞–∫—Ç–∏–≤–Ω–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—è –≤–ø–µ—á–∞—Ç–ª—è—é—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–∞—Ö. –ò–≥—Ä–æ–∫–∏ –∏–∑ –ú–æ–Ω–≥–æ–ª–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –∏–≥—Ä—ã, —Å–æ—á–µ—Ç–∞—é—â–∏–π –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å –∏ —Ç–∞–∫—Ç–∏—á–µ—Å–∫—É—é –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É."]},

            # –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã
            {"tag": "h4", "children": ["üîÆ –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã"]},
            {"tag": "p", "children": ["–° —É—á–µ—Ç–æ–º –µ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ –∏ —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞, Cobrazera –∏–º–µ–µ—Ç –≤—Å–µ —à–∞–Ω—Å—ã —Å—Ç–∞—Ç—å –æ–¥–Ω–∏–º –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –Ω–µ —Ç–æ–ª—å–∫–æ –º–æ–Ω–≥–æ–ª—å—Å–∫–æ–π, –Ω–æ –∏ –∞–∑–∏–∞—Ç—Å–∫–æ–π —Å—Ü–µ–Ω—ã CS2 –≤ –±–ª–∏–∂–∞–π—à–∏–µ –≥–æ–¥—ã."]},
            {"tag": "p", "children": ["–ï–≥–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è –Ω–∞ —Ç—É—Ä–Ω–∏—Ä–∞—Ö —Ä–∞–∑–ª–∏—á–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å–µ—Ä—å–µ–∑–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–∞—Ä—å–µ—Ä–µ. –í –±–ª–∏–∂–∞–π—à–∏–µ 2-3 –≥–æ–¥–∞ –º—ã –º–æ–∂–µ–º –æ–∂–∏–¥–∞—Ç—å –æ—Ç –Ω–µ–≥–æ –ø—Ä–æ—Ä—ã–≤–∞ –Ω–∞ –∫—Ä—É–ø–Ω—ã—Ö –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–∞—Ö."]},

            # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 2
            {"tag": "img", "attrs": {"src": "/file/936f5b8d90b8876cf9bc1.jpg"}},

            # –ò—Å—Ç–æ—á–Ω–∏–∫–∏
            {"tag": "h4", "children": ["üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏"]},
            {"tag": "ul", "children": [
                {"tag": "li", "children": ["Liquipedia Counter-Strike Wiki"]},
                {"tag": "li", "children": ["Esports Earnings"]},
                {"tag": "li", "children": ["HLTV.org"]},
                {"tag": "li", "children": ["EGamersWorld"]}
            ]},

            # –•–µ—à—Ç–µ–≥–∏
            {"tag": "p", "children": ["#Cobrazera #CS2 #TheMongolZ #–ú–æ–Ω–≥–æ–ª–∏—è #–ö–∏–±–µ—Ä—Å–ø–æ—Ä—Ç #CounterStrike #Rifler #–ú–æ–ª–æ–¥–æ–π–¢–∞–ª–∞–Ω—Ç"]}
        ]

        # –°–æ–∑–¥–∞–µ–º —Å—Ç–∞—Ç—å—é
        title = "–ê–Ω–∞—Ä–±–∏–ª–µ–≥ 'Cobrazera' –£—É–≥–∞–Ω–±–∞—è—Ä: –ë—É–¥—É—â–µ–µ –º–æ–Ω–≥–æ–ª—å—Å–∫–æ–≥–æ CS2"
        url = self.create_article_with_images(title, content)

        return url

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
if __name__ == "__main__":
    # –í–∞—à access_token
    ACCESS_TOKEN = "936f5b8d90b8876cf9bc115a69e8738797f92f14d67a00018929ea91defd"

    publisher = TelegraphPublisher(ACCESS_TOKEN)

    # –°–æ–∑–¥–∞–µ–º —Å—Ç–∞—Ç—å—é
    article_url = publisher.create_cobrazera_article()

    if article_url:
        print(f"–°—Ç–∞—Ç—å—è —Å–æ–∑–¥–∞–Ω–∞: {article_url}")
    else:
        print("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç–∞—Ç—å–∏")